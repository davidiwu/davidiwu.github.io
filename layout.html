<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="bootstrap/bootstrap.min.css">

    <style type="text/css">
        * {
            margin: 0;
        }

        html, body {
            height: 100%;
        }

        #viewer-container {
            min-height: 100%;
            height: auto !important;
            height: 100%;
            margin: 0;
        }

        #viewer-menu {
            float: right;
            min-width: 200px;
            height: 50px;
        }

        table {
            border: 5px solid black;
            width: 100%;
            height: 100%;
            padding: 5px 5px 5px 5px;
        }

            table td {
                border: 5px solid black;
            }

        #viewer-layout {
            clear: both;
            min-height: 100%;
            height: auto !important;
            height: 100%;
            margin: 0;
            background-color: white;
        }

        .table-row {
            height: 300px;
        }

        .table-colomn {
            width: 300px;
        }

        .dropdown-menu {
            min-width: 300px;
        }

        .layout-detail {
            display: inline;
            height: 40px;
        }

        #layout-menu {
            width: 150px;
            height: 40px;
        }

        svg {
            height: 100%;
        }

        .btn-layout {
            width: 70px;
            height: 40px;
        }

        #layout-toggle {
            height: 40px;
        }

        #layout-container {
            border: 1px dotted black;
            position: absolute;
            top: 45px;
            left: 150px;
            right: 0px;
            bottom: 0px;
        }

        .default-salvo-panel {
            border: 1px dashed black;
            position: absolute;
        }
    </style>
</head>
<body>
    <div id="viewer-container">

        <!-- Example split danger button -->
        <div class="btn-group">
            <button type="button" class="btn btn-danger">Action</button>
            <button type="button" class="btn btn-danger dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="sr-only">Toggle Dropdown</span>
            </button>
            <div class="dropdown-menu">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <a class="dropdown-item" href="#">Something else here</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Separated link</a>
            </div>
        </div>

        <div id="viewer-menu">
            <div class="dropdown">
                <div class="btn-group">
                    <button type="button" class="btn btn-default" id="layout-menu"><span data-bind="label">View Layout</span></button>
                    <button type="button" id="layout-toggle" class="btn btn-default dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>

                    <div class="dropdown-menu dropdown-menu-right">
                        <div class="btn-group" role="group" aria-label="Layout Select">
                            <button type="button" class="btn btn-layout" id="layout1">
                                <div class="layout-detail">
                                    <svg viewbox="0 0 100 100">
                                        <path class="arrow" d="M 50,0 L 60,10 L 20,50 L 60,90 L 50,100 L 0,50 Z" />
                                    </svg>
                                    1*1
                                </div>
                            </button>
                            <button type="button" class="btn btn-layout" id="layout4">
                                <div class="layout-detail">
                                    <svg viewbox="0 0 100 100">
                                        <path class="arrow" d="M 50,0 L 60,10 L 20,50 L 60,90 L 50,100 L 0,50 Z" />
                                    </svg>
                                    2*2
                                </div>
                            </button>
                            <button type="button" class="btn btn-layout" id="layout9">
                                <div class="layout-detail">
                                    <svg viewbox="0 0 100 100">
                                        <path class="arrow" d="M 50,0 L 60,10 L 20,50 L 60,90 L 50,100 L 0,50 Z" />
                                    </svg>
                                    3*3
                                </div>
                            </button>
                            <button type="button" class="btn btn-layout" id="layout7">
                                <div class="layout-detail">
                                    <svg viewbox="0 0 100 100">
                                        <path class="arrow" d="M 50,0 L 60,10 L 20,50 L 60,90 L 50,100 L 0,50 Z" />
                                    </svg>
                                    4*4
                                </div>
                            </button>
                            <button type="button" class="btn btn-layout" id="layout8">
                                <div class="layout-detail">
                                    <svg viewbox="0 0 100 100">
                                        <path class="arrow" d="M 50,0 L 60,10 L 20,50 L 60,90 L 50,100 L 0,50 Z" />
                                    </svg>
                                    5*5
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="layout-container">

        </div>
    </div>

    <!-- jQuery first, then Tether, then Bootstrap JS. -->
    <script src="bootstrap/jquery.min.js"></script>
    <script src="bootstrap/tether.min.js"></script>
    <script src="bootstrap/bootstrap.min.js"></script>
    <script src="bootstrap/jquery.resize.js"></script>
    <script>
        var LayoutSlot = function (top, left, width, height) {
            this.top = 0,
            this.left = 0,
            this.width = 0,
            this.height = 0,
            "undefined" != typeof top && (this.top = top),
            "undefined" != typeof left && (this.left = left),
            "undefined" != typeof width && (this.width = width),
            "undefined" != typeof height && (this.height = height)
        };
        var Layout = function (name, width, height, length, slots, aspectRatio, ws) {
            this.name = "Unnamed",
            this.width = 0,
            this.height = 0,
            this.length = 0,
            this.slots = [],
            this.aspectRatio = 4 / 3,
            this.ws = !1,
            "undefined" != typeof name && (this.name = name),
            "undefined" != typeof width && (this.width = width),
            "undefined" != typeof height && (this.height = height),
            "undefined" != typeof length && (this.length = length),
            "undefined" != typeof slots && (this.slots = slots),
            "undefined" != typeof aspectRatio && (this.aspectRatio = aspectRatio),
            "undefined" != typeof ws && (this.ws = ws)
        };

        var layouts = [];
        layouts.push(new Layout("1 Camera Layout", 1, 1, 1, [new LayoutSlot(0, 0, 1, 1)], 4 / 3, !1));
        layouts.push(new Layout("4 Camera Layout", 4, 4, 4, [new LayoutSlot(0, 0, 2, 2), new LayoutSlot(0, 2, 2, 2),
            new LayoutSlot(2, 0, 2, 2), new LayoutSlot(2, 2, 2, 2)], 4 / 3, !1));
        layouts.push(new Layout("9 Camera Layout", 3, 3, 9, [new LayoutSlot(0, 0, 1, 1), new LayoutSlot(0, 1, 1, 1),
            new LayoutSlot(0, 2, 1, 1), new LayoutSlot(1, 0, 1, 1), new LayoutSlot(1, 1, 1, 1),
            new LayoutSlot(1, 2, 1, 1), new LayoutSlot(2, 0, 1, 1), new LayoutSlot(2, 1, 1, 1),
            new LayoutSlot(2, 2, 1, 1)], 4 / 3, !1));
        layouts.push(new Layout("7 Camera Layout", 4, 4, 7, [new LayoutSlot(0, 0, 2, 2), new LayoutSlot(0, 2, 2, 2),
            new LayoutSlot(2, 0, 2, 2), new LayoutSlot(2, 2, 1, 1), new LayoutSlot(2, 3, 1, 1),
            new LayoutSlot(3, 2, 1, 1), new LayoutSlot(3, 3, 1, 1)], 4 / 3, !1));
        layouts.push(new Layout("8 Camera Layout", 4, 4, 8, [new LayoutSlot(0, 0, 3, 3), new LayoutSlot(0, 3, 1, 1),
            new LayoutSlot(1, 3, 1, 1), new LayoutSlot(2, 3, 1, 1), new LayoutSlot(3, 0, 1, 1),
            new LayoutSlot(3, 1, 1, 1), new LayoutSlot(3, 2, 1, 1), new LayoutSlot(3, 3, 1, 1)], 4 / 3, !1));

        var createSVGbutton = function (layout) {
            var svgElement = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            //$(svgElement).attr('viewbox', '0 0 100 100');
            $(svgElement).width(30);
            $(svgElement).height(30);

            widthRatio = 30 / layout.width;
            heightRatio = 30 / layout.height;

            $.each(layout.slots, function (index, value) {
                var svgRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                $(svgRect).attr({
                    x: (value.left * widthRatio),
                    y: (value.top * heightRatio),
                    width: (value.width * widthRatio),
                    height: (value.height * heightRatio)
                });
                $(svgElement).append($(svgRect));
                $(svgRect).attr({ fill: 'white', stroke: 'black' });
            });
            return svgElement;
        };

        $.each(layouts, function (index, value) {
            var btn = $('.btn-layout')[index];
            var svgContainer = $(btn).find('.layout-detail');
            $(svgContainer).empty();
            $(svgContainer).append($(createSVGbutton(value)));
        });

        var calculateDimensionsForLayout = function (layout) {
            var rightNode = $("#layout-container");

            var availableHeight = rightNode.height()
              , availableWidth = rightNode.width();

            var height = availableHeight
              , width = availableWidth;

            //width / layout.width / layout.aspectRatio > height / layout.height ? width = height / layout.height * layout.aspectRatio * layout.width : height = width / layout.width / layout.aspectRatio * layout.height;

            var slotHeight = height / layout.height
              , slotWidth = width / layout.width;
            return {
                availableHeight: availableHeight,
                availableWidth: availableWidth,
                height: Math.round(height),
                width: Math.round(width),
                slotHeight: Math.round(slotHeight),
                slotWidth: Math.round(slotWidth),
                aspectRatio: layout.aspectRatio
            }
        };

        var panelDimensionsForLayout = function (layout) {
            var dimensions = calculateDimensionsForLayout(layout)
              , topOffset = (dimensions.availableHeight - dimensions.height) / 2
              , panelDimensions = $.map(layout.slots, function (element) {
                  var height = element.height * dimensions.slotHeight
                    , width = element.width * dimensions.slotWidth
                    , top = topOffset + element.top * dimensions.slotHeight
                    , left = element.left * dimensions.slotWidth;
                  return {
                      height: height,
                      width: width,
                      top: top,
                      left: left
                  }
              });
            return panelDimensions;
        };

        var selectPanel = function (e) {
            $('.default-salvo-panel').css('border', '1px dashed black');
            var tar = $(e.currentTarget);
            tar.css('border', '2px solid black');
        };

        var createLayout = function (length) {
            var container = $('#layout-container');
            var panels = $('.default-salvo-panel');
            if (panels) {
                container.empty();
            }
            for (var i = 0; i < length; i++) {
                var template = $('#hidden-template').html();
                var panel = $(template).clone();
                container.append(panel);
            }
            $('.default-salvo-panel').on('click', selectPanel);
        };

        var getPanelById = function (panelId) {
            var panels = $('.default-salvo-panel');
            if (panels && panelId < panels.length) {
                return panels[panelId];
            }
        };

        var onShowPanel = function (panelId, newHeight, newWidth, newTop, newLeft) {
            var panel = getPanelById(panelId);
            $(panel).css('top', newTop.toString() + "px");
            $(panel).css('left', newLeft.toString() + "px");
            $(panel).show();
            $(panel).height(newHeight - 1);
            $(panel).width(newWidth - 1);
        };
        var currentLayout;
        $(document).ready(function () {
            $('.btn-layout').on('click', function (e) {
                var tar = $(e.currentTarget);
                tar.closest('.dropdown')
                    .find('[data-bind="label"]')
                    .empty()
                    .append(tar.find('.layout-detail').clone())
                    .end()
                    .find('.dropdown-toggle')
                    .dropdown('toggle');

                var layoutLength = parseInt(tar.attr("id").substr(6), 10);
                var layout = $.grep(layouts, function (element) {
                    return element.length === layoutLength
                });
                currentLayout = layout[0];
                createLayout(layoutLength);

                resizeContainer();
                //var i, panelDimensions = panelDimensionsForLayout(currentLayout);
                //for (i = 0; i < panelDimensions.length; i++) {
                //    onShowPanel(i, panelDimensions[i].height, panelDimensions[i].width, panelDimensions[i].top, panelDimensions[i].left);
                //}

                //for (var i = 0; i < 4; i++) {
                //    var template = $('#hidden-template').html();

                //    var leftPanel = $(template).clone();
                //    $(leftPanel).css('width', (panelWidth - 2) + 'px');
                //    $(leftPanel).css('height', (panelHeight - 2) + 'px');
                //    container.append(leftPanel);
                //}
                return false;
            });

        });

        var resizeContainer = function (e) {

            var i, panelDimensions = panelDimensionsForLayout(currentLayout);
            for (i = 0; i < panelDimensions.length; i++) {
                onShowPanel(i, panelDimensions[i].height, panelDimensions[i].width, panelDimensions[i].top, panelDimensions[i].left);
            }

            //alert('You just resized the green box!');
            //var container = $('#layout-container');
            //var panelWidth = container.width() / 2;
            //var panelHeight = container.height() / 2;

            //$('.default-salvo-panel').css('width', (panelWidth - 2) + 'px');
            //$('.default-salvo-panel').css('height', (panelHeight - 2) + 'px');
        };

        $(window).resize(resizeContainer);

    </script>

    <script id="hidden-template" type="text/x-custom-template">
        <div class="default-salvo-panel">

        </div>
    </script>

</body>
</html>